---
title: "üç∑ Wine Scraping"
title-block-banner: true
author: "`Guillaume DEVANT` et `Corentin DUCLOUX`"
categories: ["Python", "Streamlit","Machine Learning", "Docker", "DuckDB"]
description: "Wine Scraping est une application d√©velopp√©e sous {{< fa brands python >}} permettant de pr√©dire les prix des vins."
date: 01-06-2024
date-format: DD/MM/YYYY
image: wine_scraping\imgs\wine_scraping_main_img.png
---

## Probl√©matique

::: {.wine-scraping-intro}

![](wine_scraping/imgs/wine_scraping_logo.png){width=70% fig-align="center"}

*Le terroir est en guerre ! Menant une lutte acharn√©e pour l'information viticole, une bataille √©pique se d√©roule entre les donn√©es dissimul√©es et les amateurs assoiff√©s de connaissances sur le vin. Le chaos r√®gne alors que les sources d'informations viticoles sont assaillies par des obstacles inattendus.*

*Avec une audace stup√©fiante, les sites de revente de vin ont √©rig√© des barri√®res insurmontables, emp√™chant l'acc√®s aux d√©tails les plus pr√©cieux sur les c√©pages, les mill√©simes et les appellations. La qu√™te de ces informations devient une mission d√©sesp√©r√©e, une v√©ritable lutte pour la libert√© de l'information ≈ìnologique.*

*Face √† cette situation, deux valeureux Chevaliers de la programmation Python s'√©l√®vent pour secourir les amateurs de vin, menant une mission p√©rilleuse pour lib√©rer les donn√©es captives. Avec bravoure, ils s'attaquent aux d√©fenses num√©riques pour d√©livrer les pr√©cieuses informations contenues dans les pages web tentaculaires ...*
:::

## Aper√ßu de l'application

```{=html}
<iframe 
    width="100%"
    src="https://wine-scraping.streamlit.app/?embed=true"
    title="Wine Scraping"
    height="650"
></iframe>
```

## Description du projet

L'objectif est de r√©cup√©rer des donn√©es sur un site web, les stocker, les transformer puis les exploiter pour faire des mod√®les de **Machine Learning** ainsi qu'une application.

Le projet, dans les grandes lignes :

1. Scraping des donn√©es avec `requests` et `beautifulsoup4` {{< iconify material-symbols:soup-kitchen >}}
2. Restructuration des donn√©es avec `polars` {{< iconify openmoji:polar-bear >}}
3. Cr√©ation de pipelines de Machine Learning avec `scikit-learn` ü§ñ
4. Alimentation d'une base de donn√©es contenant les pr√©dictions des mod√®les avec `duckdb` {{< fa database >}}
5. Cr√©ation d'une application pour visualiser les r√©sultats avec `streamlit` et `plotly` üìä

## Machine Learning

Que pr√©dire ? Avec quoi le pr√©dire ? Comment utiliser les r√©sultats ? Les r√©ponses sont ci-dessous :

1. Deux variables √† pr√©dire : *unit_price* & *type*
2. Nous utiliserons 6 mod√®les de **Machine Learning**
3. ‚û∂ Optimisation des hyperparam√®tres par Cross-Validation avec `models.py`
4. üèπ Pr√©diction sur les donn√©es de test avec `prediction.py`
5. üß™ Utilisation d'un **pipeline** `sklearn`
    - Evite le Data Leakage.
    - Proc√©dure standardis√©e pour l'ensemble des mod√®les.


::: {.callout-note collapse="true"}

## Variables Explicatives

| Variable        | Type | Description                                                 |
| ------------------- | -------- | --------------------------------------------------------------- |
| `name`              | str      | _Nom du vin_                                                    |
| `capacity`          | float    | _Capacit√© en litres du vin_                                     |
| `millesime`         | int      | _Ann√©e de vendange des raisins_                                 |
| `cepage`            | str      | _Type de raisin utilis√© pour confectionner le vin_              |
| `par_gouts`         | str      | _Classification par go√ªts du vin_                               |
| `service`           | str      | _Comment se sert le vin_                                        |
| `avg_temp`          | float    | _Temp√©rature moyenne de conservation du vin_                    |
| `conservation_date` | int      | _Date de conservation maximale du vin apr√®s achat_              |
| `bio`               | bool     | _Indique si le vin est issu de l'agriculture biologique_        |
| `customer_fav`      | bool     | _Indique si le vin est un coup de coeur client_                 |
| `is_new`            | bool     | _Indique si le vin est une nouveaut√© sur le site_               |
| `top_100`           | bool     | _Indique si le vin fait partie d'un classement dans le top 100_ |
| `destock`           | bool     | _Indique si le vin est en d√©stockage_                           |
| `sulphite_free`     | bool     | _Indique si le vin est sans sulfites_                           |
| `alcohol_volume`    | float    | _Degr√© de concentration d'alcool_                               |
| `country`           | str      | _Pays d'origine du vin_                                         |
| `bubbles`           | bool     | _Indique si le vin a des bulles_                                |
| `wine_note`         | float    | _Indique la note sur 5 du vin_                                  |
| `nb_reviews`        | int      | _Nombre de commentaires_                                        |
| `conservation_time` | float    | _Dur√©e de conservation du vin en ann√©es_                        |
| `cru`               | bool     | _Indique si le vin est un grand cru_                            |

:::

## R√©sultats du Machine Learning

5 tables de r√©sultats de Machine Learning sont obtenues gr√¢ce √† l'√©x√©uction de `ml_trigger` qui se charge d'√©x√©cuter l'ensemble des scripts d'export. Mais plut√¥t que d'utiliser chaque csv ind√©pendamment ou de tenter de concat√©ner les r√©sultats, nous avons pr√©f√©r√© utiliser une base de donn√©es pour l'impl√©mentation dans notre application.

`duckdb` est une base de donn√©es particuli√®re en ce sens qu'elle n'est pas *Client-Server*, mais *in-memory*. Cela permet d‚Äôobtenir des temps de r√©ponse minimaux en √©liminant le besoin d'acc√©der √† des unit√©s de disque standard (SSD). Une base de donn√©es *in-memory* est donc id√©ale pour une application effectuant de l‚Äôanalyse de donn√©es en temps r√©el.

*Voici un sch√©ma du processus d'ingestion des tables :*

```{mermaid}
%%| fig-align: center
graph LR;
A("üë®‚Äçüî¨ pred_classification")-->F;
B("üë®‚Äçüî¨ pred_regression")-->F;
C("üë©‚Äçüè´ result_ml_regression")-->F;
D("üë©‚Äçüè´ result_ml_classification")-->F;
E("üïµÔ∏è‚Äç‚ôÇÔ∏è importance")-->F[("ü¶Ü In Memory Database")];

style A stroke:#adbac7,stroke-width:3px;
style B stroke:#adbac7,stroke-width:3px;
style C stroke:#adbac7,stroke-width:3px;
style D stroke:#adbac7,stroke-width:3px;
style E stroke:#adbac7,stroke-width:3px;
style F stroke:#fff100,stroke-width:3px;
```


## En savoir plus

$\Rightarrow$ *Repo* **Github** : [{{< fa brands github >}} Wine-Scraping](https://github.com/CDucloux/Wine-Scraping)
